"use strict";var G=Object.create;var I=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var _=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var J=(t,e)=>{for(var n in e)I(t,n,{get:e[n],enumerable:!0})},P=(t,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of W(e))!z.call(t,r)&&r!==n&&I(t,r,{get:()=>e[r],enumerable:!(i=V(e,r))||i.enumerable});return t};var K=(t,e,n)=>(n=t!=null?G(_(t)):{},P(e||!t||!t.__esModule?I(n,"default",{value:t,enumerable:!0}):n,t)),Y=t=>P(I({},"__esModule",{value:!0}),t);var j=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)};var p=(t,e,n)=>(j(t,e,"read from private field"),n?n.call(t):e.get(t)),c=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},h=(t,e,n,i)=>(j(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n);var y=(t,e,n)=>(j(t,e,"access private method"),n);var te={};J(te,{Route:()=>F});module.exports=Y(te);var D=K(require("events"));var E=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,$=function(e){return encodeURIComponent(e)};function Q(t,e){try{return e(t)}catch(n){return t}}function X(t){return t.indexOf("%")!==-1?decodeURIComponent(t):t}function Z(t){return Object.prototype.toString.call(t)==="[object Date]"||t instanceof Date}var S={serialize:(t,e,n)=>{let i=n||{},r=i.encode||$;if(typeof r!="function")throw new TypeError("option encode is invalid");if(!E.test(t))throw new TypeError("argument name is invalid");let s=r(e);if(s&&!E.test(s))throw new TypeError("argument val is invalid");let o=t+"="+s;if(i.maxAge!=null){let a=i.maxAge-0;if(isNaN(a)||!isFinite(a))throw new TypeError("option maxAge is invalid");o+="; Max-Age="+Math.floor(a)}if(i.domain){if(!E.test(i.domain))throw new TypeError("option domain is invalid");o+="; Domain="+i.domain}if(i.path){if(!E.test(i.path))throw new TypeError("option path is invalid");o+="; Path="+i.path}if(i.expires){let a=i.expires;if(!Z(a)||isNaN(a.valueOf()))throw new TypeError("option expires is invalid");o+="; Expires="+a.toUTCString()}if(i.httpOnly&&(o+="; HttpOnly"),i.secure&&(o+="; Secure"),i.priority)switch(typeof i.priority=="string"?i.priority.toLowerCase():i.priority){case"low":o+="; Priority=Low";break;case"medium":o+="; Priority=Medium";break;case"high":o+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(i.sameSite)switch(typeof i.sameSite=="string"?i.sameSite.toLowerCase():i.sameSite){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return o},parse:(t,e)=>{if(typeof t!="string")throw new TypeError("argument str must be a string");let n={},r=(e||{}).decode||X,s=0;for(;s<t.length;){let o=t.indexOf("=",s);if(o===-1)break;let a=t.indexOf(";",s);if(a===-1)a=t.length;else if(a<o){s=t.lastIndexOf(";",o-1)+1;continue}let m=t.slice(s,o).trim();if(n[m]===void 0){let l=t.slice(o+1,a).trim();l.charCodeAt(0)===34&&(l=l.slice(1,-1)),n[m]=Q(l,r)}s=a+1}return n}};var U=t=>{let e={...t};try{e.method=t.httpMethod,e.query={};for(let[i,r]of Object.entries(t.queryStringParameters))e.query[i]=decodeURIComponent(r);if(!t.isBase64Encoded&&t.headers["content-type"]=="application/json"){let i=JSON.parse(t.body);e.body=i}e.cookies=typeof t.headers.cookie=="string"?S.parse(t.headers.cookie):{},e.get=i=>t.headers[i.toLowerCase()];let n=decodeURIComponent(e.path);e.params=n.split("/").filter(i=>i)}catch(n){}return e};var k,w,C,b,x,g,N,v,q,R=class{constructor(e,n,i,r,s){c(this,g);c(this,v);c(this,k,void 0);c(this,w,void 0);c(this,C,void 0);this.responseObject={cookies:[],isBase64Encoded:!1,statusCode:200,headers:{},body:""};c(this,b,void 0);c(this,x,void 0);this.locals=i,this.callbackWaitsForEmptyEventLoop=e.callbackWaitsForEmptyEventLoop,h(this,k,e.succeed),h(this,w,e.fail),h(this,C,e.done),this.functionVersion=e.functionVersion,this.functionName=e.functionName,this.memoryLimitInMB=e.memoryLimitInMB,this.logGroupName=e.logGroupName,this.logStreamName=e.logStreamName,this.clientContext=e.clientContext,this.identity=e.identity,this.invokedFunctionArn=e.invokedFunctionArn,this.awsRequestId=e.awsRequestId,this.awsRequestId=e.awsRequestId,this.getRemainingTimeInMillis=e.getRemainingTimeInMillis,h(this,b,n),s&&(this.responseObject=s),r&&h(this,x,r)}succeed(e){p(this,k).call(this,e)}done(e,n){p(this,C).call(this,e,n)}fail(e){p(this,w).call(this,e)}cookie(e,n,i){return this.responseObject.cookies.push(S.serialize(e,n,i)),this}clearCookie(e,n){let i={expires:new Date(1),path:"/",...n};return this.cookie(e,"",i)}status(e){return this.responseObject.statusCode=e,this}type(e){return this.responseObject.headers["Content-Type"]=e,this}set(e,n){return this.responseObject.headers[e]=n,this}get(e){return this.responseObject.headers[e]}json(e){var n,i;y(i=y(n=this.type("application/json"),v,q).call(n,JSON.stringify(e)),g,N).call(i)}send(e){var n;y(n=y(this,v,q).call(this,e),g,N).call(n)}redirect(...e){var r;let n=isNaN(e[0])?302:e[0],i=typeof e[0]=="string"?e[0]:typeof e[1]=="string"?e[1]:"/";y(r=this.status(n).location(i),g,N).call(r)}location(e){let n=e;return e==="back"&&(n=p(this,x).get("Referrer")||"/"),this.set("Location",encodeURI(n))}links(e){var n=this.get("Link")||"";return n&&(n+=", "),this.set("Link",n+Object.keys(e).map(function(i){return"<"+e[i]+'>; rel="'+i+'"'}).join(", "))}};k=new WeakMap,w=new WeakMap,C=new WeakMap,b=new WeakMap,x=new WeakMap,g=new WeakSet,N=function(){this.responseObject.headers["Content-Type"]||this.type("text/html"),p(this,b).call(this,this.responseObject)},v=new WeakSet,q=function(e){return this.responseObject.body=e,this};function*ee(t){for(let e in t)yield e}var B=(t,e,n)=>{let i=null,r=e.findIndex((s,o)=>o>t&&s.length==4);if(r!=-1)for(let s=t;s<r;s++)i=e[n.next().value];return i},F=class extends Function{constructor(){super();this.controllers=[];return new Proxy(this,{apply:(n,i,r)=>n._call(...r)})}async _call(...n){let i=U(n[0]),r=n[1],s=null,o=ee(this.controllers),a=new D.default,m=u=>{s||(s=u,a.emit("end"))},l=new R(r,m,i,{}),M=0,f=async u=>{let H={...l.locals},A={...l.responseObject};if(l=new R(r,m,H,A),u){let d=B(M,this.controllers,o);if(d)try{await d(u,i,l,f),s||l.status(204).send()}catch(O){l.status(500).send("Unhandled Error")}else l.status(500).send("Unhandled Error");o.return()}let T=o.next().value;if(T){M=Number(T);let d=this.controllers[T];try{d.length==3?await d(i,l,f):d.length==4&&await d(null,i,l,f)}catch(O){let L=B(M,this.controllers,o);if(L)try{await L(O,i,l,f),s||l.status(204).send()}catch(ne){l.status(500).send("Unhandled Error")}else l.status(500).send("Unhandled Error");o.return()}}};return await new Promise(async u=>{a.once("end",u),await f()}),s!=null?s:{statusCode:204}}handle(...n){return this.controllers.push(...n),this}use(...n){return this.controllers.push(...n),this}};0&&(module.exports={Route});
